for each image in z-stack:
    get number of objects
    for each object in objects:
        get the image with highest probability for focus (for z < object z)

